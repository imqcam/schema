{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Unified Build Importer Schema",
  "description": "Metadata for ULI builds (POC: Brett Ley)",
  "type": "object",
  "definitions": {
    "fileUpload": {
      "title": "File",
      "type": "object",
      "properties": {
        "file": {
          "title": "Upload file",
          "type": "string",
          "format": "data-url",
          "description": "Select a file to upload"
        },
        "button": {
          "title": "Browse",
          "format": "button",
          "options": {
            "button": {
              "action": "button1CB",
              "uploadFor": "file"
            }
          }
        }
      },
      "required": [
        "file"
      ]
    },
    "laserSpeed": {
      "type": "number",
      "title": "Laser Speed",
      "description": "Laser speed in mm/s",
      "minimum": 0,
      "unit": "mm/s"
    },
    "hatchSpacing": {
      "type": "number",
      "title": "Hatch Spacing",
      "description": "Hatch spacing in mm",
      "minimum": 0,
      "unit": "mm"
    },
    "laserPower": {
      "type": "number",
      "title": "Laser Power",
      "description": "Laser Power in Watts",
      "minimum": 0,
      "unit": "W"
    },
    "layerThickness": {
      "type": "number",
      "title": "Layer Thickness",
      "description": "Layer thickness in mm",
      "minimum": 0,
      "unit": "mm"
    },
    "layerCount": {
      "type": "number",
      "title": "Number of Layers",
      "description": "Number of Layers",
      "minimum": 0
    }
  },
  "properties": {
    "Build": {
      "type": "object",
      "properties": {
        "UID": {
          "type": "string",
          "description": "Unique identifier for the build"
        },
        "FID": {
          "type": "string",
          "description": "Foreign identifier linking to related records"
        },
        "EOS_Job_File": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/fileUpload"
          },
          "description": "EOS job file name or path"
        },
        "Build_Report_File": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/fileUpload"
          },
          "description": "Build report file name or path"
        },
        "Feedstock_Workbook": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/fileUpload"
          },
          "description": "Feedstock workbook file path"
        },
        "Meltpool_Data": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/fileUpload"
          },
          "description": "Meltpool data file path"
        },
        "OT_Data": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/fileUpload"
          },
          "description": "OT data file path"
        },
        "Location": {
          "type": "string",
          "description": "Build location"
        },
        "Brand_Model": {
          "type": "string",
          "description": "Brand and model of the machine"
        },
        "Serial_Number": {
          "type": "string",
          "description": "Machine serial number"
        },
        "Build_Time_Est": {
          "type": "number",
          "description": "Estimated build time in hours",
          "minimum": 0,
          "unit": "hours"
        },
        "Build_Time": {
          "type": "number",
          "description": "Actual build time in hours",
          "minimum": 0,
          "unit": "hours"
        },
        "Start_Date": {
          "type": "string",
          "format": "date",
          "description": "Build start date"
        },
        "End_Date": {
          "type": "string",
          "format": "date",
          "description": "Build end date"
        },
        "Nozzle_Type": {
          "type": "string",
          "description": "Type of nozzle used"
        },
        "Max_Level_O2": {
          "type": "number",
          "description": "Maximum oxygen level in ppm",
          "minimum": 0,
          "unit": "ppm"
        },
        "Chamber_Pressure": {
          "type": "number",
          "description": "Chamber pressure in mBar",
          "minimum": 0,
          "unit": "mBar"
        },
        "Cover_Gas_Velocity": {
          "type": "number",
          "description": "Cover gas velocity in mBar",
          "minimum": 0,
          "unit": "mBar"
        },
        "Build_Plate_Thickness": {
          "type": "number",
          "description": "Build plate thickness in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Build_Plate_Material": {
          "type": "string",
          "description": "Material of the build plate"
        },
        "Bed_Preheat": {
          "type": "number",
          "description": "Bed preheat temperature in 째C",
          "unit": "celsius"
        },
        "Rake_Blade_Material": {
          "type": "string",
          "description": "Material of the rake blade"
        },
        "Deposition_Velocity": {
          "type": "number",
          "description": "Deposition velocity in mm/s",
          "minimum": 0,
          "unit": "mm/s"
        },
        "Dosing": {
          "type": "string",
          "description": "Dosing description"
        },
        "Min_Dose": {
          "type": "number",
          "description": "Minimum dose in %"
        },
        "Max_Dose": {
          "type": "number",
          "description": "Maximum dose in %"
        },
        "Min_Layer_Time": {
          "type": "number",
          "description": "Minimum layer time in seconds",
          "minimum": 0,
          "unit": "seconds"
        },
        "Move_to_Dosage_Position": {
          "type": "number",
          "description": "move to dosage position",
          "minimum": 0,
          "unit": "mm/s"
        },
        "layerThickness": {
          "$ref": "#/definitions/layerThickness"
        },
        "Build_Plate_Separation": {
          "type": "number",
          "description": "Build plate separation in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Notes": {
          "type": "string",
          "description": "Additional notes"
        },
        "Granta_Record_Name": {
          "type": "string",
          "description": "Granta record name"
        },
        "Granta_Record_Short_Name": {
          "type": "string",
          "description": "Granta short record name"
        },
        "Granta_Embed_Importer": {
          "type": "string",
          "description": "Granta embed importer info"
        },
        "Build_Project": {
          "type": "string",
          "description": "Build project name"
        },
        "Set_Point_T": {
          "type": "number",
          "description": "Set point temperature"
        }
      },
      "required": [
        "UID",
        "FID"
      ]
    },
    "Part": {
      "type": "object",
      "properties": {
        "UID": {
          "type": "string",
          "description": "Unique identifier for the part"
        },
        "FID": {
          "type": "string",
          "description": "Foreign identifier linking to build"
        },
        "Scan_Order": {
          "type": "integer",
          "description": "Scan order or number of layers"
        },
        "Plate_Location_X": {
          "type": "number",
          "description": "Plate location X coordinate in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Plate_Location_Y": {
          "type": "number",
          "description": "Plate location Y coordinate in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Global_Offset": {
          "type": "string",
          "description": "Global offset in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Offset_Angle": {
          "type": "number",
          "description": "Offset angle in degrees (째)",
          "minimum": 0,
          "unit": "degrees"
        },
        "Rotation_Angle": {
          "type": "number",
          "description": "Rotation angle in degrees (째)"
        },
        "Restriction_Angle": {
          "type": "number",
          "description": "Restriction angle in degrees (째)"
        },
        "Skip": {
          "type": "boolean",
          "description": "Flag to skip this part"
        },
        "Hatch_Offset": {
          "type": "number",
          "description": "Hatch offset in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Overlap_with_Infill": {
          "type": "number",
          "description": "Overlap with infill in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Min_Vector_Length": {
          "type": "number",
          "description": "Minimum vector length in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Note": {
          "type": "string",
          "description": "Notes related to the part"
        },
        "CAD_File": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/fileUpload"
          },
          "description": "CAD file path or name (~10-100 MB)"
        },
        "Job_File": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/fileUpload"
          },
          "description": "Job file path or name"
        },
        "Granta_Record_Name": {
          "type": "string",
          "description": "Granta record name"
        }
      },
      "required": [
        "UID",
        "FID"
      ]
    },
    "Infill_Stripes": {
      "type": "object",
      "properties": {
        "UID": {
          "type": "string",
          "description": "Unique identifier"
        },
        "FID": {
          "type": "string",
          "description": "Foreign identifier"
        },
        "Skywriting": {
          "type": "string",
          "enum": [
            "Yes",
            "No"
          ],
          "description": "Enable skywriting (Yes/No)"
        },
        "Flow_Optimization": {
          "type": "boolean",
          "description": "Flow optimization enabled (true/false)"
        },
        "Shifted": {
          "type": "boolean",
          "description": "Shifted pattern enabled (true/false)"
        },
        "Exposure_Mode": {
          "type": "string",
          "description": "Exposure mode (Single/Double)"
        },
        "Power_Reduction_Factor": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Power reduction factor (0 to 1)"
        },
        "Time_Homogenization": {
          "type": "boolean",
          "description": "Time homogenization enabled (true/false)"
        },
        "Stripe_Width": {
          "type": "number",
          "description": "Stripe width in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Overlap_Stripes": {
          "type": "number",
          "description": "Stripe overlap in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "laserPower": {
          "$ref": "#/definitions/laserPower"
        },
        "hatchSpacing": {
          "$ref": "#/definitions/hatchSpacing"
        },
        "laserSpeed": {
          "$ref": "#/definitions/laserSpeed"
        },
        "General": {
          "type": "string",
          "description": "General notes or parameters"
        },
        "Granta_Record_Name": {
          "type": "string",
          "description": "Granta record name"
        }
      },
      "required": [
        "UID",
        "FID"
      ]
    },
    "Upskin": {
      "type": "object",
      "properties": {
        "UID": {
          "type": "string",
          "description": "Unique identifier"
        },
        "FID": {
          "type": "string",
          "description": "Foreign identifier"
        },
        "Hatch_Sorting": {
          "type": "string",
          "enum": [
            "Straight Lined",
            "Time Optimized"
          ],
          "description": "Hatch sorting method"
        },
        "Skywriting": {
          "type": "string",
          "enum": [
            "Yes",
            "No"
          ],
          "description": "Enable skywriting"
        },
        "Exposure_Mode": {
          "type": "string",
          "enum": [
            "Single",
            "Double"
          ],
          "description": "Exposure mode"
        },
        "Upskin_LayerCount": {
          "$ref": "#/definitions/layerCount"
        },
        "Upskin_Ridge": {
          "type": "number",
          "description": "Upskin ridge height in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "laserPower": {
          "$ref": "#/definitions/laserPower"
        },
        "hatchSpacing": {
          "$ref": "#/definitions/hatchSpacing"
        },
        "laserSpeed": {
          "$ref": "#/definitions/laserSpeed"
        },
        "General": {
          "type": "string",
          "description": "General notes"
        }
      },
      "required": [
        "UID",
        "FID"
      ]
    },
    "Downskin": {
      "type": "object",
      "properties": {
        "UID": {
          "type": "string",
          "description": "Unique identifier"
        },
        "FID": {
          "type": "string",
          "description": "Foreign identifier"
        },
        "Hatch_Sorting": {
          "type": "string",
          "enum": [
            "Straight lined",
            "Time optimized"
          ],
          "description": "Hatch sorting method"
        },
        "Skywriting": {
          "type": "string",
          "enum": [
            "Yes",
            "No"
          ],
          "description": "Enable skywriting"
        },
        "Exposure_Mode": {
          "type": "string",
          "enum": [
            "Single",
            "Double"
          ],
          "description": "Exposure mode"
        },
        "Downskin_LayerCount": {
          "$ref": "#/definitions/layerCount"
        },
        "Upskin_Ridge": {
          "type": "number",
          "description": "Ridge height in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "laserPower": {
          "$ref": "#/definitions/laserPower"
        },
        "hatchSpacing": {
          "$ref": "#/definitions/hatchSpacing"
        },
        "laserSpeed": {
          "$ref": "#/definitions/laserSpeed"
        },
        "General": {
          "type": "string",
          "description": "General notes"
        }
      },
      "required": [
        "UID",
        "FID"
      ]
    },
    "Contour": {
      "type": "object",
      "properties": {
        "UID": {
          "type": "string",
          "description": "Unique identifier"
        },
        "FID": {
          "type": "string",
          "description": "Foreign identifier"
        },
        "Contour_Number": {
          "type": "integer",
          "description": "Number of contour passes",
          "minimum": 0
        },
        "Contour_Offset": {
          "type": "number",
          "description": "Offset from part boundary in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Thickness": {
          "$ref": "#/definitions/layerCount"
        },
        "Corridor": {
          "type": "number",
          "description": "Corridor distance in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "laserPower1": {
          "$ref": "#/definitions/laserPower"
        },
        "laserSpeed1": {
          "$ref": "#/definitions/laserSpeed"
        },
        "laserPower2": {
          "title": "Laser Power 2",
          "$ref": "#/definitions/laserPower"
        },
        "laserSpeed2": {
          "title": "Laser Speed 2",
          "$ref": "#/definitions/laserSpeed"
        },
        "laserPower3": {
          "title": "Laser Power 3",
          "$ref": "#/definitions/laserPower"
        },
        "laserSpeed3": {
          "title": "Laser Speed 3",
          "$ref": "#/definitions/laserSpeed"
        }
      },
      "required": [
        "UID",
        "FID"
      ]
    },
    "Edge": {
      "type": "object",
      "properties": {
        "UID": {
          "type": "string",
          "description": "Unique identifier"
        },
        "FID": {
          "type": "string",
          "description": "Foreign identifier"
        },
        "Edge_Offset": {
          "type": "number",
          "description": "Offset from part edge in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Edge_Factor": {
          "type": "number",
          "description": "Factor applied to edge regions"
        },
        "Threshold": {
          "type": "number",
          "description": "Threshold value for edge enhancement"
        },
        "Min_Radius_Factor": {
          "type": "number",
          "description": "Minimum radius factor for edge detection",
          "minimum": 0
        },
        "laserPower": {
          "$ref": "#/definitions/laserPower"
        },
        "laserSpeed": {
          "$ref": "#/definitions/laserSpeed"
        }
      },
      "required": [
        "UID",
        "FID"
      ]
    },
    "Support_Bulk": {
      "type": "object",
      "properties": {
        "UID": {
          "type": "string",
          "description": "Unique identifier"
        },
        "FID": {
          "type": "string",
          "description": "Foreign identifier"
        },
        "Files": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/fileUpload"
          },
          "description": "Bulk upload of .stl files"
        },
        "Overlap_in_Part": {
          "type": "number",
          "description": "Overlap in part in mm",
          "minimum": 0,
          "unit": "mm"
        },
        "Rotation": {
          "type": "number",
          "description": "Rotation angle in degrees",
          "minimum": 0,
          "unit": "degrees"
        },
        "Skip": {
          "type": "boolean",
          "description": "Flag to skip the part"
        },
        "laserPower": {
          "$ref": "#/definitions/laserPower"
        },
        "hatchSpacing": {
          "$ref": "#/definitions/hatchSpacing"
        },
        "laserSpeed": {
          "$ref": "#/definitions/laserSpeed"
        },
        "Notes": {
          "type": "string",
          "description": "Additional notes"
        },
        "Support": {
          "type": "string",
          "description": "Support type or description"
        }
      },
      "required": [
        "UID",
        "FID",
        "Files"
      ]
    }
  },
  "required": [
    "Build",
    "Part",
    "Infill_Stripes",
    "Upskin",
    "Downskin",
    "Contour",
    "Edge",
    "Support_Bulk"
  ]
}